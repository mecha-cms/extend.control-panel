!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t,r,i){this.cm=e,this.node=t,this.options=r,this.height=i,this.cleared=!1}function r(e){var t=e.getWrapperElement(),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,i=parseInt(r.height),n=e.state.panels={setHeight:t.style.height,heightLeft:i,panels:0,wrapper:document.createElement("div")};t.parentNode.insertBefore(n.wrapper,t);var a=e.hasFocus();n.wrapper.appendChild(t),a&&e.focus(),e._setSize=e.setSize,null!=i&&(e.setSize=function(t,r){if(null==r)return this._setSize(t,r);if(n.setHeight=r,"number"!=typeof r){var a=/^(\d+\.?\d*)px$/.exec(r);a?r=Number(a[1]):(n.wrapper.style.height=r,r=n.wrapper.offsetHeight,n.wrapper.style.height="")}e._setSize(t,n.heightLeft+=r-i),i=r})}function i(e){var t=e.state.panels;e.state.panels=null;var r=e.getWrapperElement();t.wrapper.parentNode.replaceChild(r,t.wrapper),r.style.height=t.setHeight,e.setSize=e._setSize,e.setSize()}function n(e,t){for(var r=t.nextSibling;r;r=r.nextSibling)if(r==e.getWrapperElement())return!0;return!1}e.defineExtension("addPanel",function(e,i){i=i||{},this.state.panels||r(this);var a=this.state.panels,o=a.wrapper,l=this.getWrapperElement();i.after instanceof t&&!i.after.cleared?o.insertBefore(e,i.before.node.nextSibling):i.before instanceof t&&!i.before.cleared?o.insertBefore(e,i.before.node):i.replace instanceof t&&!i.replace.cleared?(o.insertBefore(e,i.replace.node),i.replace.clear()):"bottom"==i.position?o.appendChild(e):"before-bottom"==i.position?o.insertBefore(e,l.nextSibling):"after-top"==i.position?o.insertBefore(e,l):o.insertBefore(e,o.firstChild);var s=i&&i.height||e.offsetHeight;return this._setSize(null,a.heightLeft-=s),a.panels++,i.stable&&n(this,e)&&this.scrollTo(null,this.getScrollInfo().top+s),new t(this,e,i,s)}),t.prototype.clear=function(){if(!this.cleared){this.cleared=!0;var e=this.cm.state.panels;this.cm._setSize(null,e.heightLeft+=this.height),this.options.stable&&n(this.cm,this.node)&&this.cm.scrollTo(null,this.cm.getScrollInfo().top-this.height),e.wrapper.removeChild(this.node),0==--e.panels&&i(this.cm)}},t.prototype.changed=function(e){var t=null==e?this.node.offsetHeight:e,r=this.cm.state.panels;this.cm._setSize(null,r.heightLeft-=t-this.height),this.height=t}});