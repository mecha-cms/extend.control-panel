!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t){if(!e.hasOwnProperty(t))throw new Error("Undefined state "+t+" in simple mode")}function n(e,t){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((t===!1?"":"^")+"(?:"+e+")",n)}function r(e){if(!e)return null;if(e.apply)return e;if("string"==typeof e)return e.replace(/\./g," ");for(var t=[],n=0;n<e.length;n++)t.push(e[n]&&e[n].replace(/\./g," "));return t}function a(e,a){(e.next||e.push)&&t(a,e.next||e.push),this.regex=n(e.regex),this.token=r(e.token),this.data=e}function o(e,t){return function(n,r){if(r.pending){var a=r.pending.shift();return 0==r.pending.length&&(r.pending=null),n.pos+=a.text.length,a.token}if(r.local){if(r.local.end&&n.match(r.local.end)){var o=r.local.endToken||null;return r.local=r.localState=null,o}var i,o=r.local.mode.token(n,r.localState);return r.local.endScan&&(i=r.local.endScan.exec(n.current()))&&(n.pos=n.start+i.index),o}for(var l=e[r.state],f=0;f<l.length;f++){var u=l[f],c=(!u.data.sol||n.sol())&&n.match(u.regex);if(c){u.data.next?r.state=u.data.next:u.data.push?((r.stack||(r.stack=[])).push(r.state),r.state=u.data.push):u.data.pop&&r.stack&&r.stack.length&&(r.state=r.stack.pop()),u.data.mode&&s(t,r,u.data.mode,u.token),u.data.indent&&r.indent.push(n.indentation()+t.indentUnit),u.data.dedent&&r.indent.pop();var d=u.token;if(d&&d.apply&&(d=d(c)),c.length>2){r.pending=[];for(var m=2;m<c.length;m++)c[m]&&r.pending.push({text:c[m],token:u.token[m-1]});return n.backUp(c[0].length-(c[1]?c[1].length:0)),d[0]}return d&&d.join?d[0]:d}}return n.next(),null}}function i(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;var n=0;for(var r in e)if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r)||!i(e[r],t[r]))return!1;n++}for(var r in t)t.hasOwnProperty(r)&&n--;return 0==n}function s(t,r,a,o){var s;if(a.persistent)for(var l=r.persistentStates;l&&!s;l=l.next)(a.spec?i(a.spec,l.spec):a.mode==l.mode)&&(s=l);var f=s?s.mode:a.mode||e.getMode(t,a.spec),u=s?s.state:e.startState(f);a.persistent&&!s&&(r.persistentStates={mode:f,spec:a.spec,state:u,next:r.persistentStates}),r.localState=u,r.local={mode:f,end:a.end&&n(a.end),endScan:a.end&&a.forceEnd!==!1&&n(a.end,!1),endToken:o&&o.join?o[o.length-1]:o}}function l(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0}function f(t,n){return function(r,a,o){if(r.local&&r.local.mode.indent)return r.local.mode.indent(r.localState,a,o);if(null==r.indent||r.local||n.dontIndentStates&&l(r.state,n.dontIndentStates)>-1)return e.Pass;var i=r.indent.length-1,s=t[r.state];e:for(;;){for(var f=0;f<s.length;f++){var u=s[f];if(u.data.dedent&&u.data.dedentIfLineStart!==!1){var c=u.regex.exec(a);if(c&&c[0]){i--,(u.next||u.push)&&(s=t[u.next||u.push]),a=a.slice(c[0].length);continue e}}}break}return 0>i?0:r.indent[i]}}e.defineSimpleMode=function(t,n){e.defineMode(t,function(t){return e.simpleMode(t,n)})},e.simpleMode=function(n,r){t(r,"start");var i={},s=r.meta||{},l=!1;for(var u in r)if(u!=s&&r.hasOwnProperty(u))for(var c=i[u]=[],d=r[u],m=0;m<d.length;m++){var p=d[m];c.push(new a(p,r)),(p.indent||p.dedent)&&(l=!0)}var y={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:l?[]:null}},copyState:function(t){var n={state:t.state,pending:t.pending,local:t.local,localState:null,indent:t.indent&&t.indent.slice(0)};t.localState&&(n.localState=e.copyState(t.local.mode,t.localState)),t.stack&&(n.stack=t.stack.slice(0));for(var r=t.persistentStates;r;r=r.next)n.persistentStates={mode:r.mode,spec:r.spec,state:r.state==t.localState?n.localState:e.copyState(r.mode,r.state),next:n.persistentStates};return n},token:o(i,n),innerMode:function(e){return e.local&&{mode:e.local.mode,state:e.localState}},indent:f(i,s)};if(s)for(var v in s)s.hasOwnProperty(v)&&(y[v]=s[v]);return y}});