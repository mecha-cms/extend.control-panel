!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function r(e,t){return e.line-t.line||e.ch-t.ch}function a(e,t,r,i){this.line=t,this.ch=r,this.cm=e,this.text=e.getLine(t),this.min=i?Math.max(i.from,e.firstLine()):e.firstLine(),this.max=i?Math.min(i.to-1,e.lastLine()):e.lastLine()}function l(e,r){var i=e.cm.getTokenTypeAt(t(e.line,r));return i&&/\btag\b/.test(i)}function s(e){return e.line>=e.max?void 0:(e.ch=0,e.text=e.cm.getLine(++e.line),!0)}function c(e){return e.line<=e.min?void 0:(e.text=e.cm.getLine(--e.line),e.ch=e.text.length,!0)}function u(e){for(;;){var t=e.text.indexOf(">",e.ch);if(-1==t){if(s(e))continue;return}{if(l(e,t+1)){var r=e.text.lastIndexOf("/",t),i=r>-1&&!/\S/.test(e.text.slice(r+1,t));return e.ch=t+1,i?"selfClose":"regular"}e.ch=t+1}}}function f(e){for(;;){var t=e.ch?e.text.lastIndexOf("<",e.ch-1):-1;if(-1==t){if(c(e))continue;return}if(l(e,t+1)){o.lastIndex=t,e.ch=t;var r=o.exec(e.text);if(r&&r.index==t)return r}else e.ch=t}}function d(e){for(;;){o.lastIndex=e.ch;var t=o.exec(e.text);if(!t){if(s(e))continue;return}{if(l(e,t.index+1))return e.ch=t.index+t[0].length,t;e.ch=t.index+1}}}function p(e){for(;;){var t=e.ch?e.text.lastIndexOf(">",e.ch-1):-1;if(-1==t){if(c(e))continue;return}{if(l(e,t+1)){var r=e.text.lastIndexOf("/",t),i=r>-1&&!/\S/.test(e.text.slice(r+1,t));return e.ch=t+1,i?"selfClose":"regular"}e.ch=t}}}function m(e,r){for(var i=[];;){var o,n=d(e),a=e.line,l=e.ch-(n?n[0].length:0);if(!n||!(o=u(e)))return;if("selfClose"!=o)if(n[1]){for(var s=i.length-1;s>=0;--s)if(i[s]==n[2]){i.length=s;break}if(0>s&&(!r||r==n[2]))return{tag:n[2],from:t(a,l),to:t(e.line,e.ch)}}else i.push(n[2])}}function h(e,r){for(var i=[];;){var n=p(e);if(!n)return;if("selfClose"!=n){var o=e.line,a=e.ch,l=f(e);if(!l)return;if(l[1])i.push(l[2]);else{for(var s=i.length-1;s>=0;--s)if(i[s]==l[2]){i.length=s;break}if(0>s&&(!r||r==l[2]))return{tag:l[2],from:t(e.line,e.ch),to:t(o,a)}}}else f(e)}}var t=e.Pos,i="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n=i+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",o=new RegExp("<(/?)(["+i+"]["+n+"]*)","g");e.registerHelper("fold","xml",function(e,r){for(var i=new a(e,r.line,0);;){var o,n=d(i);if(!n||i.line!=r.line||!(o=u(i)))return;if(!n[1]&&"selfClose"!=o){var l=t(i.line,i.ch),s=m(i,n[2]);return s&&{from:l,to:s.from}}}}),e.findMatchingTag=function(e,i,n){var o=new a(e,i.line,i.ch,n);if(-1!=o.text.indexOf(">")||-1!=o.text.indexOf("<")){var l=u(o),s=l&&t(o.line,o.ch),c=l&&f(o);if(l&&c&&!(r(o,i)>0)){var d={from:t(o.line,o.ch),to:s,tag:c[2]};return"selfClose"==l?{open:d,close:null,at:"open"}:c[1]?{open:h(o,c[2]),close:d,at:"close"}:(o=new a(e,s.line,s.ch,n),{open:d,close:m(o,c[2]),at:"open"})}}},e.findEnclosingTag=function(e,t,r,i){for(var n=new a(e,t.line,t.ch,r);;){var o=h(n,i);if(!o)break;var l=new a(e,t.line,t.ch,r),s=m(l,o.tag);if(s)return{open:o,close:s}}},e.scanForClosingTag=function(e,t,r,i){var n=new a(e,t.line,t.ch,i?{from:0,to:i}:null);return m(n,r)}});