!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function n(e,t,n){var o=e.getLineHandle(t.line),l=t.ch-1,s=n&&n.afterCursor;null==s&&(s=/(^| )cm-fat-cursor($| )/.test(e.getWrapperElement().className));var u=!s&&l>=0&&i[o.text.charAt(l)]||i[o.text.charAt(++l)];if(!u)return null;var c=">"==u.charAt(1)?1:-1;if(n&&n.strict&&c>0!=(l==t.ch))return null;var f=e.getTokenTypeAt(r(t.line,l+1)),d=a(e,r(t.line,l+(c>0?1:0)),c,f||null,n);return null==d?null:{from:r(t.line,l),to:d&&d.pos,match:d&&d.ch==u.charAt(0),forward:c>0}}function a(e,t,n,a,o){for(var l=o&&o.maxScanLineLength||1e4,s=o&&o.maxScanLines||1e3,u=[],c=o&&o.bracketRegex?o.bracketRegex:/[(){}[\]]/,f=n>0?Math.min(t.line+s,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-s),d=t.line;d!=f;d+=n){var p=e.getLine(d);if(p){var m=n>0?0:p.length-1,h=n>0?p.length:-1;if(!(p.length>l))for(d==t.line&&(m=t.ch-(0>n?1:0));m!=h;m+=n){var g=p.charAt(m);if(c.test(g)&&(void 0===a||e.getTokenTypeAt(r(d,m+1))==a)){var v=i[g];if(">"==v.charAt(1)==n>0)u.push(g);else{if(!u.length)return{pos:r(d,m),ch:g};u.pop()}}}}}return d-n==(n>0?e.lastLine():e.firstLine())?!1:null}function o(e,i,a){for(var o=e.state.matchBrackets.maxHighlightLineLength||1e3,l=[],s=e.listSelections(),u=0;u<s.length;u++){var c=s[u].empty()&&n(e,s[u].head,a);if(c&&e.getLine(c.from.line).length<=o){var f=c.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";l.push(e.markText(c.from,r(c.from.line,c.from.ch+1),{className:f})),c.to&&e.getLine(c.to.line).length<=o&&l.push(e.markText(c.to,r(c.to.line,c.to.ch+1),{className:f}))}}if(l.length){t&&e.state.focused&&e.focus();var d=function(){e.operation(function(){for(var e=0;e<l.length;e++)l[e].clear()})};if(!i)return d;setTimeout(d,800)}}function s(e){e.operation(function(){l&&(l(),l=null),l=o(e,!1,e.state.matchBrackets)})}var t=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),r=e.Pos,i={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},l=null;e.defineOption("matchBrackets",!1,function(t,r,i){i&&i!=e.Init&&(t.off("cursorActivity",s),l&&(l(),l=null)),r&&(t.state.matchBrackets="object"==typeof r?r:{},t.on("cursorActivity",s))}),e.defineExtension("matchBrackets",function(){o(this,!0)}),e.defineExtension("findMatchingBracket",function(e,t,r){return(r||"boolean"==typeof t)&&(r?(r.strict=t,t=r):t=t?{strict:!0}:null),n(this,e,t)}),e.defineExtension("scanForBracket",function(e,t,r,i){return a(this,e,t,r,i)})});