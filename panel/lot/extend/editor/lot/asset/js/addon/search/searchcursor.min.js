!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function r(e){var t=e.flags;return null!=t?t:(e.ignoreCase?"i":"")+(e.global?"g":"")+(e.multiline?"m":"")}function i(e){return e.global?e:new RegExp(e.source,r(e)+"g")}function n(e){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(e.source)}function o(e,r,n){r=i(r);for(var o=n.line,a=n.ch,l=e.lastLine();l>=o;o++,a=0){r.lastIndex=a;var s=e.getLine(o),c=r.exec(s);if(c)return{from:t(o,c.index),to:t(o,c.index+c[0].length),match:c}}}function a(e,r,a){if(!n(r))return o(e,r,a);r=i(r);for(var l,s=1,c=a.line,u=e.lastLine();u>=c;){for(var f=0;s>f;f++){var d=e.getLine(c++);l=null==l?d:l+"\n"+d}s=2*s,r.lastIndex=a.ch;var p=r.exec(l);if(p){var h=l.slice(0,p.index).split("\n"),m=p[0].split("\n"),g=a.line+h.length-1,v=h[h.length-1].length;return{from:t(g,v),to:t(g+m.length-1,1==m.length?v+m[0].length:m[m.length-1].length),match:p}}}}function l(e,t){for(var i,r=0;;){t.lastIndex=r;var n=t.exec(e);if(!n)return i;if(i=n,r=i.index+(i[0].length||1),r==e.length)return i}}function s(e,r,n){r=i(r);for(var o=n.line,a=n.ch,s=e.firstLine();o>=s;o--,a=-1){var c=e.getLine(o);a>-1&&(c=c.slice(0,a));var u=l(c,r);if(u)return{from:t(o,u.index),to:t(o,u.index+u[0].length),match:u}}}function c(e,r,n){r=i(r);for(var o,a=1,s=n.line,c=e.firstLine();s>=c;){for(var u=0;a>u;u++){var f=e.getLine(s--);o=null==o?f.slice(0,n.ch):f+"\n"+o}a*=2;var d=l(o,r);if(d){var p=o.slice(0,d.index).split("\n"),h=d[0].split("\n"),m=s+p.length,g=p[p.length-1].length;return{from:t(m,g),to:t(m+h.length-1,1==h.length?g+h[0].length:h[h.length-1].length),match:d}}}}function d(e,t,r,i){if(e.length==t.length)return r;for(var n=Math.min(r,e.length);;){var o=i(e.slice(0,n)).length;if(r>o)++n;else{if(!(o>r))return n;--n}}}function p(e,r,i,n){if(!r.length)return null;var o=n?u:f,a=o(r).split(/\r|\n\r?/);e:for(var l=i.line,s=i.ch,c=e.lastLine()+1-a.length;c>=l;l++,s=0){var p=e.getLine(l).slice(s),h=o(p);if(1==a.length){var m=h.indexOf(a[0]);if(-1==m)continue e;var i=d(p,h,m,o)+s;return{from:t(l,d(p,h,m,o)+s),to:t(l,d(p,h,m+a[0].length,o)+s)}}var g=h.length-a[0].length;if(h.slice(g)==a[0]){for(var v=1;v<a.length-1;v++)if(o(e.getLine(l+v))!=a[v])continue e;var y=e.getLine(l+a.length-1),b=o(y),x=a[a.length-1];if(y.slice(0,x.length)==x)return{from:t(l,d(p,h,g,o)+s),to:t(l+a.length-1,d(y,b,x.length,o))}}}}function h(e,r,i,n){if(!r.length)return null;var o=n?u:f,a=o(r).split(/\r|\n\r?/);e:for(var l=i.line,s=i.ch,c=e.firstLine()-1+a.length;l>=c;l--,s=-1){var p=e.getLine(l);s>-1&&(p=p.slice(0,s));var h=o(p);if(1==a.length){var m=h.lastIndexOf(a[0]);if(-1==m)continue e;return{from:t(l,d(p,h,m,o)),to:t(l,d(p,h,m+a[0].length,o))}}var g=a[a.length-1];if(h.slice(0,g.length)==g){for(var v=1,i=l-a.length+1;v<a.length-1;v++)if(o(e.getLine(i+v))!=a[v])continue e;var y=e.getLine(l+1-a.length),b=o(y);if(b.slice(b.length-a[0].length)==a[0])return{from:t(l+1-a.length,d(y,b,y.length-a[0].length,o)),to:t(l,d(p,h,g.length,o))}}}}function m(e,r,n,l){this.atOccurrence=!1,this.doc=e,n=n?e.clipPos(n):t(0,0),this.pos={from:n,to:n};var u;"object"==typeof l?u=l.caseFold:(u=l,l=null),"string"==typeof r?(null==u&&(u=!1),this.matches=function(t,i){return(t?h:p)(e,r,i,u)}):(r=i(r),l&&l.multiline===!1?this.matches=function(t,i){return(t?s:o)(e,r,i)}:this.matches=function(t,i){return(t?c:a)(e,r,i)})}var u,f,t=e.Pos;String.prototype.normalize?(u=function(e){return e.normalize("NFD").toLowerCase()},f=function(e){return e.normalize("NFD")}):(u=function(e){return e.toLowerCase()},f=function(e){return e}),m.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(r){for(var i=this.matches(r,this.doc.clipPos(r?this.pos.from:this.pos.to));i&&0==e.cmpPos(i.from,i.to);)r?i.from.ch?i.from=t(i.from.line,i.from.ch-1):i=i.from.line==this.doc.firstLine()?null:this.matches(r,this.doc.clipPos(t(i.from.line-1))):i.to.ch<this.doc.getLine(i.to.line).length?i.to=t(i.to.line,i.to.ch+1):i=i.to.line==this.doc.lastLine()?null:this.matches(r,t(i.to.line+1,0));if(i)return this.pos=i,this.atOccurrence=!0,this.pos.match||!0;var n=t(r?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:n,to:n},this.atOccurrence=!1},from:function(){return this.atOccurrence?this.pos.from:void 0},to:function(){return this.atOccurrence?this.pos.to:void 0},replace:function(r,i){if(this.atOccurrence){var n=e.splitLines(r);this.doc.replaceRange(n,this.pos.from,this.pos.to,i),this.pos.to=t(this.pos.from.line+n.length-1,n[n.length-1].length+(1==n.length?this.pos.from.ch:0))}}},e.defineExtension("getSearchCursor",function(e,t,r){return new m(this.doc,e,t,r)}),e.defineDocExtension("getSearchCursor",function(e,t,r){return new m(this,e,t,r)}),e.defineExtension("selectMatches",function(t,r){for(var i=[],n=this.getSearchCursor(t,this.getCursor("from"),r);n.findNext()&&!(e.cmpPos(n.to(),this.getCursor("to"))>0);)i.push({anchor:n.from(),head:n.to()});i.length&&this.setSelections(i,0)})});