!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(e){function i(i){if(i.getOption("disableInput"))return e.Pass;for(var n=i.listSelections(),a=[],s=0;s<n.length;s++){if(!n[s].empty())return e.Pass;var u=n[s].head,c=i.getTokenAt(u),f=e.innerMode(i.getMode(),c.state),d=f.state;if("xml"!=f.mode.name||!d.tagName)return e.Pass;var p=i.getOption("autoCloseTags"),m="html"==f.mode.configuration,h="object"==typeof p&&p.dontCloseTags||m&&t,g="object"==typeof p&&p.indentTags||m&&r,v=d.tagName;c.end>u.ch&&(v=v.slice(0,v.length-c.end+u.ch));var y=v.toLowerCase();if(!v||"string"==c.type&&(c.end!=u.ch||!/[\"\']/.test(c.string.charAt(c.string.length-1))||1==c.string.length)||"tag"==c.type&&"closeTag"==d.type||c.string.indexOf("/")==c.string.length-1||h&&o(h,y)>-1||l(i,v,u,d,!0))return e.Pass;var b=g&&o(g,y)>-1;a[s]={indent:b,text:">"+(b?"\n\n":"")+"</"+v+">",newPos:b?e.Pos(u.line+1,0):e.Pos(u.line,u.ch+1)}}for(var s=n.length-1;s>=0;s--){var x=a[s];i.replaceRange(x.text,n[s].head,n[s].anchor,"+insert");var _=i.listSelections().slice(0);_[s]={head:x.newPos,anchor:x.newPos},i.setSelections(_),x.indent&&(i.indentLine(x.newPos.line,null,!0),i.indentLine(x.newPos.line+1,null,!0))}}function n(t,r){for(var i=t.listSelections(),n=[],a=r?"/":"</",o=0;o<i.length;o++){if(!i[o].empty())return e.Pass;var s=i[o].head,u=t.getTokenAt(s),c=e.innerMode(t.getMode(),u.state),f=c.state;if(r&&("string"==u.type||"<"!=u.string.charAt(0)||u.start!=s.ch-1))return e.Pass;var d;if("xml"!=c.mode.name)if("htmlmixed"==t.getMode().name&&"javascript"==c.mode.name)d=a+"script";else{if("htmlmixed"!=t.getMode().name||"css"!=c.mode.name)return e.Pass;d=a+"style"}else{if(!f.context||!f.context.tagName||l(t,f.context.tagName,s,f))return e.Pass;d=a+f.context.tagName}">"!=t.getLine(s.line).charAt(u.end)&&(d+=">"),n[o]=d}t.replaceSelections(n),i=t.listSelections();for(var o=0;o<i.length;o++)(o==i.length-1||i[o].head.line<i[o+1].head.line)&&t.indentLine(i[o].head.line)}function a(t){return t.getOption("disableInput")?e.Pass:n(t,!0)}function o(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,i=e.length;i>r;++r)if(e[r]==t)return r;return-1}function l(t,r,i,n,a){if(!e.scanForClosingTag)return!1;var o=Math.min(t.lastLine()+1,i.line+500),l=e.scanForClosingTag(t,i,null,o);if(!l||l.tag!=r)return!1;for(var s=n.context,u=a?1:0;s&&s.tagName==r;s=s.prev)++u;i=l.to;for(var c=1;u>c;c++){var f=e.scanForClosingTag(t,i,null,o);if(!f||f.tag!=r)return!1;i=f.to}return!0}e.defineOption("autoCloseTags",!1,function(t,r,n){if(n!=e.Init&&n&&t.removeKeyMap("autoCloseTags"),r){var o={name:"autoCloseTags"};("object"!=typeof r||r.whenClosing)&&(o["'/'"]=function(e){return a(e)}),("object"!=typeof r||r.whenOpening)&&(o["'>'"]=function(e){return i(e)}),t.addKeyMap(o)}});var t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],r=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];e.commands.closeTag=function(e){return n(e)}});