!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(t,r){function o(r){if(e.findModeByName){var i=e.findModeByName(r);i&&(r=i.mime||i.mimes[0])}var n=e.getMode(t,r);return"null"==n.name?null:n}function g(e,t,r){return t.f=t.inline=r,r(e,t)}function v(e,t,r){return t.f=t.block=r,r(e,t)}function y(e){return!e||!/\S/.test(e.string)}function x(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,e.f==w&&(e.f=M,e.block=b),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine=null,null}function b(t,i){var n=t.sol(),l=i.list!==!1,h=i.indentedCode;i.indentedCode=!1,l&&(i.indentationDiff>=0?(i.indentationDiff<4&&(i.indentation-=i.indentationDiff),i.list=null):i.indentation>0?i.list=null:i.list=!1);var m=null;if(i.indentationDiff>=4&&(h||y(i.prevLine)))return t.skipToEnd(),i.indentation-=4,i.indentedCode=!0,a.code;if(t.eatSpace())return null;if((m=t.match(c))&&m[1].length<=6)return i.header=m[1].length,r.highlightFormatting&&(i.formatting="header"),i.f=i.inline,C(i);if(!(y(i.prevLine)||i.quote||l||h)&&(m=t.match(d)))return i.header="="==m[0].charAt(0)?1:2,r.highlightFormatting&&(i.formatting="header"),i.f=i.inline,C(i);if(t.eat(">"))return i.quote=n?1:i.quote+1,r.highlightFormatting&&(i.formatting="quote"),t.eatSpace(),C(i);if("["===t.peek())return g(t,i,N);if(t.match(s,!0))return i.hr=!0,a.hr;if(m=t.match(u)){var v=m[1]?"ol":"ul";for(i.indentation=t.column()+t.current().length,i.list=!0;i.listStack&&t.column()<i.listStack[i.listStack.length-1];)i.listStack.pop();return i.listStack.push(i.indentation),r.taskLists&&t.match(f,!1)&&(i.taskList=!0),i.f=i.inline,r.highlightFormatting&&(i.formatting=["list","list-"+v]),C(i)}return r.fencedCodeBlocks&&(m=t.match(p,!0))?(i.fencedChars=m[1],i.localMode=o(m[2]),i.localMode&&(i.localState=e.startState(i.localMode)),i.f=i.block=k,r.highlightFormatting&&(i.formatting="code-block"),i.code=-1,C(i)):g(t,i,i.inline)}function w(t,r){var o=i.token(t,r.htmlState);if(!n){var a=e.innerMode(i,r.htmlState);("xml"==a.mode.name&&null===a.state.tagStart&&!a.state.context&&a.state.tokenize.isInText||r.md_inside&&t.current().indexOf(">")>-1)&&(r.f=M,r.block=b,r.htmlState=null)}return o}function k(e,t){if(t.fencedChars&&e.match(t.fencedChars)){r.highlightFormatting&&(t.formatting="code-block");var i=C(t);return t.localMode=t.localState=null,t.block=b,t.f=M,t.fencedChars=null,t.code=0,i}return t.fencedChars&&e.skipTo(t.fencedChars)?"comment":t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),a.code)}function C(e){var t=[];if(e.formatting){t.push(a.formatting),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var i=0;i<e.formatting.length;i++)t.push(a.formatting+"-"+e.formatting[i]),"header"===e.formatting[i]&&t.push(a.formatting+"-"+e.formatting[i]+"-"+e.header),"quote"===e.formatting[i]&&(!r.maxBlockquoteDepth||r.maxBlockquoteDepth>=e.quote?t.push(a.formatting+"-"+e.formatting[i]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref?t.push(a.linkHref,"url"):(e.strong&&t.push(a.strong),e.em&&t.push(a.em),e.strikethrough&&t.push(a.strikethrough),e.linkText&&t.push(a.linkText),e.code&&t.push(a.code),e.image&&t.push(a.image),e.imageAltText&&t.push(a.imageAltText,"link"),e.imageMarker&&t.push(a.imageMarker)),e.header&&t.push(a.header,a.header+"-"+e.header),e.quote&&(t.push(a.quote),!r.maxBlockquoteDepth||r.maxBlockquoteDepth>=e.quote?t.push(a.quote+"-"+e.quote):t.push(a.quote+"-"+r.maxBlockquoteDepth)),e.list!==!1){var n=(e.listStack.length-1)%3;n?1===n?t.push(a.list2):t.push(a.list3):t.push(a.list1)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function S(e,t){return e.match(h,!0)?C(t):void 0}function M(t,n){var o=n.text(t,n);if("undefined"!=typeof o)return o;if(n.list)return n.list=null,C(n);if(n.taskList){var l="x"!==t.match(f,!0)[1];return l?n.taskOpen=!0:n.taskClosed=!0,r.highlightFormatting&&(n.formatting="task"),n.taskList=!1,C(n)}if(n.taskOpen=!1,n.taskClosed=!1,n.header&&t.match(/^#+$/,!0))return r.highlightFormatting&&(n.formatting="header"),C(n);var s=t.next();if(n.linkTitle){n.linkTitle=!1;var u=s;"("===s&&(u=")"),u=(u+"").replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1");var c="^\\s*(?:[^"+u+"\\\\]+|\\\\\\\\|\\\\.)"+u;if(t.match(new RegExp(c),!0))return a.linkHref}if("`"===s){var d=n.formatting;r.highlightFormatting&&(n.formatting="code"),t.eatWhile("`");var h=t.current().length;if(0==n.code)return n.code=h,C(n);if(h==n.code){var p=C(n);return n.code=0,p}return n.formatting=d,C(n)}if(n.code)return C(n);if("\\"===s&&(t.next(),r.highlightFormatting)){var g=C(n),y=a.formatting+"-escape";return g?g+" "+y:y}if("!"===s&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return n.imageMarker=!0,n.image=!0,r.highlightFormatting&&(n.formatting="image"),C(n);if("["===s&&n.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return n.imageMarker=!1,n.imageAltText=!0,r.highlightFormatting&&(n.formatting="image"),C(n);if("]"===s&&n.imageAltText){r.highlightFormatting&&(n.formatting="image");var g=C(n);return n.imageAltText=!1,n.image=!1,n.inline=n.f=T,g}if("["===s&&!n.image)return n.linkText=!0,r.highlightFormatting&&(n.formatting="link"),C(n);if("]"===s&&n.linkText){r.highlightFormatting&&(n.formatting="link");var g=C(n);return n.linkText=!1,n.inline=n.f=t.match(/\(.*?\)| ?\[.*?\]/,!1)?T:M,g}if("<"===s&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){n.f=n.inline=L,r.highlightFormatting&&(n.formatting="link");var g=C(n);return g?g+=" ":g="",g+a.linkInline}if("<"===s&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){n.f=n.inline=L,r.highlightFormatting&&(n.formatting="link");var g=C(n);return g?g+=" ":g="",g+a.linkEmail}if("<"===s&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var x=t.string.indexOf(">",t.pos);if(-1!=x){var b=t.string.substring(t.start,x);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(b)&&(n.md_inside=!0)}return t.backUp(1),n.htmlState=e.startState(i),v(t,n,w)}if("<"===s&&t.match(/^\/\w*?>/))return n.md_inside=!1,"tag";if("*"===s||"_"===s){for(var k=1,S=1==t.pos?" ":t.string.charAt(t.pos-2);3>k&&t.eat(s);)k++;var O=t.peek()||" ",A=!/\s/.test(O)&&(!m.test(O)||/\s/.test(S)||m.test(S)),N=!/\s/.test(S)&&(!m.test(S)||/\s/.test(O)||m.test(O)),D=null,z=null;if(k%2&&(n.em||!A||"*"!==s&&N&&!m.test(S)?n.em!=s||!N||"*"!==s&&A&&!m.test(O)||(D=!1):D=!0),k>1&&(n.strong||!A||"*"!==s&&N&&!m.test(S)?n.strong!=s||!N||"*"!==s&&A&&!m.test(O)||(z=!1):z=!0),null!=z||null!=D){r.highlightFormatting&&(n.formatting=null==D?"strong":null==z?"em":"strong em"),D===!0&&(n.em=s),z===!0&&(n.strong=s);var p=C(n);return D===!1&&(n.em=!1),z===!1&&(n.strong=!1),p}}else if(" "===s&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return C(n);t.backUp(1)}if(r.strikethrough)if("~"===s&&t.eatWhile(s)){if(n.strikethrough){r.highlightFormatting&&(n.formatting="strikethrough");var p=C(n);return n.strikethrough=!1,p}if(t.match(/^[^\s]/,!1))return n.strikethrough=!0,r.highlightFormatting&&(n.formatting="strikethrough"),C(n)}else if(" "===s&&t.match(/^~~/,!0)){if(" "===t.peek())return C(n);t.backUp(2)}return" "===s&&(t.match(/ +$/,!1)?n.trailingSpace++:n.trailingSpace&&(n.trailingSpaceNewLine=!0)),C(n)}function L(e,t){var i=e.next();if(">"===i){t.f=t.inline=M,r.highlightFormatting&&(t.formatting="link");var n=C(t);return n?n+=" ":n="",n+a.linkInline}return e.match(/^[^>]+/,!0),a.linkInline}function T(e,t){if(e.eatSpace())return null;var i=e.next();return"("===i||"["===i?(t.f=t.inline=A("("===i?")":"]"),r.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,C(t)):"error"}function A(e){return function(t,i){var n=t.next();if(n===e){i.f=i.inline=M,r.highlightFormatting&&(i.formatting="link-string");var o=C(i);return i.linkHref=!1,o}return t.match(O[e]),i.linkHref=!0,C(i)}}function N(e,t){return e.match(/^([^\]\\]|\\.)*\]:/,!1)?(t.f=D,e.next(),r.highlightFormatting&&(t.formatting="link"),t.linkText=!0,C(t)):g(e,t,M)}function D(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=z,r.highlightFormatting&&(t.formatting="link");var i=C(t);return t.linkText=!1,i}return e.match(/^([^\]\\]|\\.)+/,!0),a.linkText}function z(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=M,a.linkHref+" url")}var i=e.getMode(t,"text/html"),n="null"==i.name;void 0===r.highlightFormatting&&(r.highlightFormatting=!1),void 0===r.maxBlockquoteDepth&&(r.maxBlockquoteDepth=0),void 0===r.taskLists&&(r.taskLists=!1),void 0===r.strikethrough&&(r.strikethrough=!1),void 0===r.tokenTypeOverrides&&(r.tokenTypeOverrides={});var a={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var l in a)a.hasOwnProperty(l)&&r.tokenTypeOverrides[l]&&(a[l]=r.tokenTypeOverrides[l]);var s=/^([*\-_])(?:\s*\1){2,}\s*$/,u=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,f=/^\[(x| )\](?=\s)/,c=r.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,d=/^ *(?:\={1,}|-{1,})\s*$/,h=/^[^#!\[\]*_\\<>` "'(~]+/,p=new RegExp("^("+(r.fencedCodeBlocks===!0?"~~~+|```+":r.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),m=/[!\"#$%&\'()*+,\-\.\/:;<=>?@\[\\\]^_`{|}~â€”]/,O={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/},P={startState:function(){return{f:b,prevLine:null,thisLine:null,block:b,htmlState:null,indentation:0,inline:M,text:S,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&e.copyState(i,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkText:t.linkText,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(e,t){if(t.formatting=!1,e!=t.thisLine){var r=t.header||t.hr;if(t.header=0,t.hr=!1,e.match(/^\s*$/,!0)||r){if(x(t),!r)return null;t.prevLine=null}if(t.prevLine=t.thisLine,t.thisLine=e,t.taskList=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block,t.f!=w){var i=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(t.indentationDiff=Math.min(i-t.indentation,4),t.indentation=t.indentation+t.indentationDiff,i>0)return null}}return t.f(e,t)},innerMode:function(e){return e.block==w?{state:e.htmlState,mode:i}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:P}},indent:function(t,r,n){return t.block==w?i.indent(t.htmlState,r,n):t.localState?t.localMode.indent(t.localState,r,n):e.Pass},blankLine:x,getType:C,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return P},"xml"),e.defineMIME("text/x-markdown","markdown")});