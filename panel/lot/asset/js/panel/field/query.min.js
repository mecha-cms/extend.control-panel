/*!
 * ==============================================================
 *  TAG PICKER 3.0.7
 * ==============================================================
 * Author: Taufik Nurrohman <https://github.com/taufik-nurrohman>
 * License: MIT
 * --------------------------------------------------------------
 */
!function(t,n,e){function r(t,n){var e=n[M](t);return 0>e?null:e}function i(t,n){return t[T].remove(n)}function u(t,n){return t[T].add(n)}function o(t){return Object.keys(t).length}function a(t,n){return Object.assign(t,n)}function c(t,n){return n[M](t)>=0}function s(t){return"function"==typeof t}function f(t){return"number"==typeof t}function l(t){return void 0!==t}function g(t){return"string"==typeof t}function d(t){v(t)&&t[z][P](t)}function v(t){return t&&t[z]}function p(t,e,r){var i,u,o=g(t)?n[S](t):t;if((e||""===e)&&(o[A]=e),r)for(i in r)u=r[i],null===u||!1===u?o[B](i):o[X](i,u);return o}var h="Arrow",m=h+"Left",b=h+"Right",y="Backspace",w="Delete",x="Enter",$="Tab",k="__instance__",E="appendChild",_="children",T="classList",S="createElement",O="ctrlKey",j="disabled",L="firstChild",R="forEach",C="getAttribute",M="indexOf",A="innerHTML",N="insertBefore",K="key",D=K+"Code",q="nextSibling",I="nodeName",z="parentNode",H="previousSibling",J="readOnly",B="removeAttribute",P="removeChild",W="replace",X="setAttribute",Y="shiftKey",F="textContent",G="toLowerCase",Q=setTimeout;!function(t){t.version="3.0.7",t[k]={},t.each=function(n,e){var r,i;return Q(function(){i=t[k];for(r in i)n.call(i[r],r)},0===e?0:e||1),t},t.I={"Maximum tags allowed is %d":"Maximum tags allowed is %d.","Minimum tags allowed is %d":"Minimum tags allowed is %d.","Remove tag %s":"Remove tag “%s”","Tag %s already exists":"Tag “%s” already exists."},t.i=function(n,e){return n=t.I[n]||n,e&&e[R](function(t){n=n[W]("%"+(f(t)?"d":"s"),t)}),n},t._=t.prototype}(t[e]=function(n,v){function h(t,n,e){return l(Ln[t])||(Ln[t]={}),l(e)||(e=o(Ln[t])),Ln[t][e]=n,En}function T(t,n){return l(t)?l(n)?(delete Ln[t][n],En):(Ln[t]={},En):(Ln={},En)}function S(t,n,e){if(!l(Ln[t]))return En;if(l(e))l(Ln[t][e])&&Ln[t][e].apply(En,n);else for(var r in Ln[t])Ln[t][r].apply(En,n);return En}function M(t){return En.f(t)[W](RegExp("("+Rn.escape.join("|")[W](/\\/g,"\\\\")+")+"),"").trim()}function B(t){if(n[j]||n[J])return ln("");var e,r=M(Nn[F]);r&&(pn(r)?t&&fn("Tag %s already exists",[r]):(bn(r),mn(r),e=En.tags.length,S("change",[r,e]),S("set.tag",[r,e])),ln(""))}function P(){B(1),i(Cn,"focus"),i(Cn,"focus.input"),S("blur",[kn,En.tags.length])}function X(){S("click",[En.tags])}function U(){u(Cn,"focus"),u(Cn,"focus.input"),S("focus",[En.tags])}function V(t){var e,r=Rn.escape,u=t[D],o=t[K],a=t[O],s=x===o||13===u,f=t[Y],l=$===o||9===u,g=An[H],d=En.tags.length,v=Rn.max,p=M(Nn[F]);s?o="\n":l&&(o="	"),l||(n[j]||n[J]?(s&&n[J]&&wn(),vn(t)):c(o,r)||c(u,r)?(v>d?B(1):(ln(""),fn("Maximum tags allowed is %d",[v])),vn(t)):s?(wn(),vn(t)):Q(function(){var n=Nn[F],s=M(n);c(n.slice(-1),r)?(v>d?B(1):(ln(""),fn("Maximum tags allowed is %d",[v])),vn(t)):""!==s||a||f||(""!==p||y!==o&&8!==u?(m===o||37===u)&&g&&g.focus():(e=En.tags[d-1],i(Cn,"focus.tag"),yn(e),hn(e),g&&(S("change",[e,d-1]),S("let.tag",[e,d-1])))),Kn[A]=s?"":Tn},0))}function Z(t){if(Cn[z])for(var e;e=An[H];)yn(e.title);for(En.tags=[],n.value="",t=t?t.split(Rn.join):[],$n=Rn.max,xn=0;$n>xn&&t[xn];++xn)if(""!==(kn=M(t[xn]))){if(pn(kn))continue;bn(kn),mn(kn),S("change",[kn,xn]),S("set.tag",[kn,xn])}}function tn(t){if(!n[j]){var e=Rn.min;return B(),e>0&&En.tags.length<e?(ln("",1),fn("Minimum tags allowed is %d",[e]),void vn(t)):1}}function nn(){Q(function(){n[j]||n[J]||Z(Nn[F]),ln("")},0)}function en(t){t&&Cn===t.target&&(Nn.focus(),X())}function rn(){Nn.focus()}function un(){var t=this,n=t.title;i(Cn,"focus"),i(Cn,"focus.tag"),S("blur.tag",[n,r(n,En.tags)])}function on(){var t=this.title;S("click.tag",[t,r(t,En.tags)])}function an(){var t=this,n=t.title;u(Cn,"focus"),u(Cn,"focus.tag"),S("focus.tag",[n,r(n,En.tags)])}function cn(t){if(!n[j]&&!n[J]){var e=this[z].title;yn(e),hn(e),ln("",1)}vn(t)}function sn(t){var e=this,u=t[D],o=t[K],a=(t[O],n[J]),c=(t[Y],e[H]),s=e[q];if(a||m!==o&&37!==u)if(a||b!==o&&39!==u){if(y===o||w===o||8===u||46===u){if(!a){var f=e.title,l=r(f,En.tags);i(Cn,"focus.tag"),yn(f),hn(f),y===o||8===u?c?c.focus():ln("",1):s&&s!==An?s.focus():ln("",1),S("change",[f,l]),S("let.tag",[f,l])}vn(t)}}else s&&s!==An?s.focus():ln("",1),vn(t);else c&&(c.focus(),vn(t))}function fn(t,n){var e,r=Rn.alert;!0===r&&(e=_n.i(t,n))?alert(e):s(r)?r.apply(En,n):g(r)&&_n[r]&&_n[r].apply(En,n)}function ln(t,n){Nn[F]=t,Kn[F]=t?"":Tn,n&&Nn.focus()}function gn(t,n,e){t.removeEventListener(n,e)}function dn(t,n,e){t.addEventListener(n,e,!1)}function vn(t){t&&t.preventDefault()}function pn(t,n){var e=r(t,En.tags);return n&&S("get.tag",[t,e]),f(e)?t:null}function hn(t){var e=r(t,En.tags);return f(e)&&e>=0?(En.tags.splice(e,1),n.value=En.tags.join(Rn.join),!0):!1}function mn(t,e){f(e)?(e=0>e?0:e,En.tags.splice(e,0,t)):En.tags.push(t),n.value=En.tags.join(Rn.join)}function bn(t,e){var r=p("span",0,{"class":"tag",tabindex:n[j]?!1:"0",title:t});if(Rn.x){var i=p("a",0,{href:"",tabindex:"-1",title:_n.i("Remove tag %s",[t])});dn(i,"click",cn),r[E](i)}dn(r,"blur",un),dn(r,"click",on),dn(r,"focus",an),dn(r,"keydown",sn),Mn[z]&&(f(e)&&En.tags[e]?Mn[N](r,Mn[_][e]):Mn[N](r,An))}function yn(t){var n,e=r(t,En.tags);if(f(e)&&e>=0&&(n=Mn.children[e])){if(gn(n,"blur",un),gn(n,"click",on),gn(n,"focus",an),gn(n,"keydown",sn),Rn.x){var i=n[L];gn(i,"click",cn),d(i)}d(n)}}function wn(){tn()&&jn&&jn.submit()}if(n){var xn,$n,kn,En=this,_n=t[e],Tn=n.placeholder||"",Sn=n[C]("tabindex"),On={alert:!0,"class":"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1};if(n[e])return En;if(!(En instanceof _n))return new _n(n,v);_n[k][n.id||n.name||o(_n[k])]=En,n[e]=1,g(v)&&(v={join:v});var jn,Ln={},Rn=a(On,v),Cn=p("span",0,{"class":Rn["class"]}),Mn=p("span",0,{"class":"tags"}),An=p("span",0,{"class":"editor tag"}),Nn=p("span",0,{contenteditable:n[j]?!1:"true",spellcheck:"false",style:"white-space:pre;"}),Kn=p("span");for(En.f=function(t){return t[G]()[W](/[^ a-z0-9-]/g,"")},ln(""),u(n,Rn["class"]+"-source"),n[z][N](Cn,n[q]),Cn[E](Mn),Mn[E](An),An[E](Nn),An[E](Kn),p(n,0,{tabindex:"-1"}),jn=n[z];jn&&jn[I]&&"form"!==jn[I][G]();)jn=jn[z];dn(Nn,"blur",P),dn(Nn,"click",X),dn(Nn,"focus",U),dn(Nn,"keydown",V),dn(Nn,"paste",nn),dn(n,"focus",rn),dn(Cn,"click",en),jn&&dn(jn,"submit",tn),En.tags=[],Z(n.value),En.input=Nn,En.self=En.view=Cn,En.source=En.output=n,En.state=Rn,En.blur=function(){return!n[j]&&(Nn.blur(),P()),En},En.click=function(){return Cn.click(),en(),En},En.fire=function(t,n,e){return S(t,n,e)},En.focus=function(){return n[j]||(Nn.focus(),U()),En},En.get=function(t){return n[j]?null:pn(t,1)},En.let=function(t,e){if(!n[j]&&!n[J]){var r=Rn.min;if(B(),e&&r>0&&En.tags.length<r)return fn("Minimum tags allowed is %d",[r]),En;yn(t),hn(t)}return En},En.on=function(t,n,e){return h(t,n,e)},En.off=function(t,n){return T(t,n)},En.pop=function(){return n[e]?(delete n[e],gn(Nn,"blur",P),gn(Nn,"click",X),gn(Nn,"focus",U),gn(Nn,"keydown",V),gn(Nn,"paste",nn),gn(n,"focus",rn),gn(Cn,"click",en),jn&&gn(jn,"submit",tn),En.tags[R](yn),i(n,Rn["class"]+"-source"),p(n,0,{tabindex:Sn}),d(Cn),S("pop")):En},En.set=function(t,e,r){if(!n[j]&&!n[J])if(pn(t))r&&fn("Tag %s already exists",[t]);else{var i=Rn.max;En.tags.length<i?(bn(t,e),mn(t,e)):r&&fn("Maximum tags allowed is %d",[i])}return En},En.value=function(t){return!n[j]&&!n[J]&&Z(t),En}}})}(window,document,"TP"),function(t,n){function e(){var n,e,r=t.querySelectorAll(".field\\:query .input");r.length&&r.forEach(function(t){e=t.className,n=new TP(t,JSON.parse(t.getAttribute("data-state")||"{}")),n.view.className+=" "+e})}e(),n.on("change",e)}(document,_);
