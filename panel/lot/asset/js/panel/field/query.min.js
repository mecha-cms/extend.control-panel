/*!
 * ==============================================================
 *  TAG PICKER 3.0.7
 * ==============================================================
 * Author: Taufik Nurrohman <https://github.com/taufik-nurrohman>
 * License: MIT
 * --------------------------------------------------------------
 */
!function(t,e,n){function o(t,e){var n=e[q](t);return 0>n?null:n}function r(t,e){return t[S].remove(e)}function i(t,e){return t[S].add(e)}function s(t){return Object.keys(t).length}function a(t,e){return Object.assign(t,e)}function c(t,e){return e[q](t)>=0}function u(t){return"function"==typeof t}function l(t){return"number"==typeof t}function f(t){return void 0!==t}function d(t){return"string"==typeof t}function p(t){h(t)&&t[D][I](t)}function h(t){return t&&t[D]}function v(t,n,o){var r,i,s=d(t)?e[_](t):t;if((n||""===n)&&(s[O]=n),o)for(r in o)i=o[r],null===i||!1===i?s[B](r):s[J](r,i);return s}var m="Arrow",g=m+"Left",b=m+"Right",w="Backspace",y="Delete",x="Enter",E="Tab",k="__instance__",T="appendChild",L="children",S="classList",_="createElement",j="ctrlKey",$="disabled",A="firstChild",N="forEach",R="getAttribute",q="indexOf",O="innerHTML",C="insertBefore",P="key",M=P+"Code",H="nextSibling",U="nodeName",D="parentNode",X="previousSibling",K="readOnly",B="removeAttribute",I="removeChild",F="replace",J="setAttribute",z="shiftKey",W="textContent",G="toLowerCase",V=setTimeout;!function(t){t.version="3.0.7",t[k]={},t.each=function(e,n){var o,r;return V(function(){r=t[k];for(o in r)e.call(r[o],o)},0===n?0:n||1),t},t.I={"Maximum tags allowed is %d":"Maximum tags allowed is %d.","Minimum tags allowed is %d":"Minimum tags allowed is %d.","Remove tag %s":"Remove tag “%s”","Tag %s already exists":"Tag “%s” already exists."},t.i=function(e,n){return e=t.I[e]||e,n&&n[N](function(t){e=e[F]("%"+(l(t)?"d":"s"),t)}),e},t._=t.prototype}(t[n]=function(e,h){function m(t,e,n){return f($e[t])||($e[t]={}),f(n)||(n=s($e[t])),$e[t][n]=e,ke}function S(t,e){return f(t)?f(e)?(delete $e[t][e],ke):($e[t]={},ke):($e={},ke)}function _(t,e,n){if(!f($e[t]))return ke;if(f(n))f($e[t][n])&&$e[t][n].apply(ke,e);else for(var o in $e[t])$e[t][o].apply(ke,e);return ke}function q(t){return ke.f(t)[F](RegExp("("+Ae.escape.join("|")[F](/\\/g,"\\\\")+")+"),"").trim()}function B(t){if(e[$]||e[K])return le("");var n,o=q(Oe[W]);o&&(he(o)?t&&ue("Tag %s already exists",[o]):(ge(o),me(o),n=ke.tags.length,_("change",[o,n]),_("set.tag",[o,n])),le(""))}function I(){B(1),r(Ne,"focus"),r(Ne,"focus.input"),_("blur",[Ee,ke.tags.length])}function J(){_("click",[ke.tags])}function Y(){i(Ne,"focus"),i(Ne,"focus.input"),_("focus",[ke.tags])}function Q(t){var n,o=Ae.escape,i=t[M],s=t[P],a=t[j],u=x===s||13===i,l=t[z],f=E===s||9===i,d=qe[X],p=ke.tags.length,h=Ae.max,v=q(Oe[W]);u?s="\n":f&&(s="	"),f||(e[$]||e[K]?(u&&e[K]&&we(),pe(t)):c(s,o)||c(i,o)?(h>p?B(1):(le(""),ue("Maximum tags allowed is %d",[h])),pe(t)):u?(we(),pe(t)):V(function(){var e=Oe[W],u=q(e);c(e.slice(-1),o)?(h>p?B(1):(le(""),ue("Maximum tags allowed is %d",[h])),pe(t)):""!==u||a||l||(""!==v||w!==s&&8!==i?(g===s||37===i)&&d&&d.focus():(n=ke.tags[p-1],r(Ne,"focus.tag"),be(n),ve(n),d&&(_("change",[n,p-1]),_("let.tag",[n,p-1])))),Ce[O]=u?"":Le},0))}function Z(t){if(Ne[D])for(var n;n=qe[X];)be(n.title);for(ke.tags=[],e.value="",t=t?t.split(Ae.join):[],xe=Ae.max,ye=0;xe>ye&&t[ye];++ye)if(""!==(Ee=q(t[ye]))){if(he(Ee))continue;ge(Ee),me(Ee),_("change",[Ee,ye]),_("set.tag",[Ee,ye])}}function te(t){if(!e[$]){var n=Ae.min;return B(),n>0&&ke.tags.length<n?(le("",1),ue("Minimum tags allowed is %d",[n]),void pe(t)):1}}function ee(){V(function(){e[$]||e[K]||Z(Oe[W]),le("")},0)}function ne(t){t&&Ne===t.target&&(Oe.focus(),J())}function oe(){Oe.focus()}function re(){var t=this,e=t.title;r(Ne,"focus"),r(Ne,"focus.tag"),_("blur.tag",[e,o(e,ke.tags)])}function ie(){var t=this.title;_("click.tag",[t,o(t,ke.tags)])}function se(){var t=this,e=t.title;i(Ne,"focus"),i(Ne,"focus.tag"),_("focus.tag",[e,o(e,ke.tags)])}function ae(t){if(!e[$]&&!e[K]){var n=this[D].title;be(n),ve(n),le("",1)}pe(t)}function ce(t){var n=this,i=t[M],s=t[P],a=(t[j],e[K]),c=(t[z],n[X]),u=n[H];if(a||g!==s&&37!==i)if(a||b!==s&&39!==i){if(w===s||y===s||8===i||46===i){if(!a){var l=n.title,f=o(l,ke.tags);r(Ne,"focus.tag"),be(l),ve(l),w===s||8===i?c?c.focus():le("",1):u&&u!==qe?u.focus():le("",1),_("change",[l,f]),_("let.tag",[l,f])}pe(t)}}else u&&u!==qe?u.focus():le("",1),pe(t);else c&&(c.focus(),pe(t))}function ue(t,e){var n,o=Ae.alert;!0===o&&(n=Te.i(t,e))?alert(n):u(o)?o.apply(ke,e):d(o)&&Te[o]&&Te[o].apply(ke,e)}function le(t,e){Oe[W]=t,Ce[W]=t?"":Le,e&&Oe.focus()}function fe(t,e,n){t.removeEventListener(e,n)}function de(t,e,n){t.addEventListener(e,n,!1)}function pe(t){t&&t.preventDefault()}function he(t,e){var n=o(t,ke.tags);return e&&_("get.tag",[t,n]),l(n)?t:null}function ve(t){var n=o(t,ke.tags);return l(n)&&n>=0?(ke.tags.splice(n,1),e.value=ke.tags.join(Ae.join),!0):!1}function me(t,n){l(n)?(n=0>n?0:n,ke.tags.splice(n,0,t)):ke.tags.push(t),e.value=ke.tags.join(Ae.join)}function ge(t,n){var o=v("span",0,{"class":"tag",tabindex:e[$]?!1:"0",title:t});if(Ae.x){var r=v("a",0,{href:"",tabindex:"-1",title:Te.i("Remove tag %s",[t])});de(r,"click",ae),o[T](r)}de(o,"blur",re),de(o,"click",ie),de(o,"focus",se),de(o,"keydown",ce),Re[D]&&(l(n)&&ke.tags[n]?Re[C](o,Re[L][n]):Re[C](o,qe))}function be(t){var e,n=o(t,ke.tags);if(l(n)&&n>=0&&(e=Re.children[n])){if(fe(e,"blur",re),fe(e,"click",ie),fe(e,"focus",se),fe(e,"keydown",ce),Ae.x){var r=e[A];fe(r,"click",ae),p(r)}p(e)}}function we(){te()&&je&&je.submit()}if(e){var ye,xe,Ee,ke=this,Te=t[n],Le=e.placeholder||"",Se=e[R]("tabindex"),_e={alert:!0,"class":"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1};if(e[n])return ke;if(!(ke instanceof Te))return new Te(e,h);Te[k][e.id||e.name||s(Te[k])]=ke,e[n]=1,d(h)&&(h={join:h});var je,$e={},Ae=a(_e,h),Ne=v("span",0,{"class":Ae["class"]}),Re=v("span",0,{"class":"tags"}),qe=v("span",0,{"class":"editor tag"}),Oe=v("span",0,{contenteditable:e[$]?!1:"true",spellcheck:"false",style:"white-space:pre;"}),Ce=v("span");for(ke.f=function(t){return t[G]()[F](/[^ a-z0-9-]/g,"")},le(""),i(e,Ae["class"]+"-source"),e[D][C](Ne,e[H]),Ne[T](Re),Re[T](qe),qe[T](Oe),qe[T](Ce),v(e,0,{tabindex:"-1"}),je=e[D];je&&je[U]&&"form"!==je[U][G]();)je=je[D];de(Oe,"blur",I),de(Oe,"click",J),de(Oe,"focus",Y),de(Oe,"keydown",Q),de(Oe,"paste",ee),de(e,"focus",oe),de(Ne,"click",ne),je&&de(je,"submit",te),ke.tags=[],Z(e.value),ke.input=Oe,ke.self=ke.view=Ne,ke.source=ke.output=e,ke.state=Ae,ke.blur=function(){return!e[$]&&(Oe.blur(),I()),ke},ke.click=function(){return Ne.click(),ne(),ke},ke.fire=function(t,e,n){return _(t,e,n)},ke.focus=function(){return e[$]||(Oe.focus(),Y()),ke},ke.get=function(t){return e[$]?null:he(t,1)},ke.let=function(t,n){if(!e[$]&&!e[K]){var o=Ae.min;if(B(),n&&o>0&&ke.tags.length<o)return ue("Minimum tags allowed is %d",[o]),ke;be(t),ve(t)}return ke},ke.on=function(t,e,n){return m(t,e,n)},ke.off=function(t,e){return S(t,e)},ke.pop=function(){return e[n]?(delete e[n],fe(Oe,"blur",I),fe(Oe,"click",J),fe(Oe,"focus",Y),fe(Oe,"keydown",Q),fe(Oe,"paste",ee),fe(e,"focus",oe),fe(Ne,"click",ne),je&&fe(je,"submit",te),ke.tags[N](be),r(e,Ae["class"]+"-source"),v(e,0,{tabindex:Se}),p(Ne),_("pop")):ke},ke.set=function(t,n,o){if(!e[$]&&!e[K])if(he(t))o&&ue("Tag %s already exists",[t]);else{var r=Ae.max;ke.tags.length<r?(ge(t,n),me(t,n)):o&&ue("Maximum tags allowed is %d",[r])}return ke},ke.value=function(t){return!e[$]&&!e[K]&&Z(t),ke}}})}(window,document,"TP"),function(t,e){function n(){for(var e in TP.__instance__)TP.__instance__[e].pop(),delete TP.__instance__[e];var n,o,r=t.querySelectorAll(".field\\:query .input");r.length&&r.forEach(function(t){o=t.className,n=new TP(t,JSON.parse(t.getAttribute("data-state")||"{}")),n.view.className+=" "+o})}n(),e.on("change",n)}(document,_);
